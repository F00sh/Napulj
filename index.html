<!doctype html>
<html lang="hr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GONZO NAPULJ ZA NINU ‚Äî Magazin + interaktivna karta</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <style>
    :root{
      /* LIGHT */
      --paper:#faf7ef;
      --ink:#1f1e1c;
      --muted:#676056;
      --rule:#d9cfbe;
      --accent:#a14232;
      --safe:#0f6d3d;
      --danger:#9a1e1e;
      --event:#5a48d6;
      --chip:#f1e9d7;
      --panel:#fffef9;
      --card:#fff;
      --shadow:0 8px 24px rgba(0,0,0,.06);
    }
    [data-theme="dark"]{
      /* DARK */
      --paper:#141311;
      --ink:#f6f2ea;
      --muted:#b9b1a6;
      --rule:#3d382f;
      --accent:#d86a59;
      --chip:#1d1b18;
      --panel:#191815;
      --card:#151410;
      --shadow:0 8px 24px rgba(0,0,0,.45);
    }

    html,body{height:100%; background:var(--paper); color:var(--ink);}
    body{
      margin:0;
      font: 17px/1.65 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }

    .wrap{
      display:grid; grid-template-columns: minmax(0,1fr) minmax(340px,520px);
      gap:2.2rem; max-width:1320px; padding:28px 20px; margin:0 auto;
    }
    header{
      grid-column:1/-1; text-align:center; margin-bottom:8px;
      border-bottom: 3px double var(--rule); padding-bottom:16px; position:relative;
    }
    .masthead{ font-family:"Playfair Display", serif; font-weight:800; letter-spacing:.5px; font-size: clamp(30px,4.2vw,52px); }
    .dek{ color:var(--muted); font-style:italic; margin-top:6px; max-width:72ch; margin-inline:auto; }

    /* Dark mode button */
    .theme-btn{
      position:absolute; right:10px; top:10px;
      border:1px solid var(--rule); background:var(--panel); color:var(--ink);
      padding:.45rem .65rem; border-radius:999px; display:flex; align-items:center; gap:.45rem;
      cursor:pointer; box-shadow: var(--shadow); font: 600 14px/1 Inter, sans-serif;
    }
    .theme-btn svg{ width:18px; height:18px; display:block; }

    .article{ column-count: 2; column-gap: 2.4rem; }
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr;} .article{column-count:1;} }

    h2,h3{
      break-inside: avoid; line-height:1.2; margin: 1.6rem 0 .6rem;
      font-family:"Playfair Display", serif; font-weight:800;
    }
    h2{ font-size: 28px; border-top:1px solid var(--rule); border-bottom:1px solid var(--rule); padding:.35rem 0; }
    h3{ font-size: 22px; }
    p{ margin:.65rem 0; }
    .lead:first-letter{
      float:left; font-family:"Playfair Display", serif; font-size:3.3rem; line-height:.85;
      padding:.2rem .5rem .2rem 0; font-weight:800; color:var(--accent);
    }
    .kicker{
      display:inline-flex; gap:.6rem; align-items:center;
      font-variant:all-small-caps; letter-spacing:1px; font-weight:800;
      border:1px solid var(--rule); padding:.25rem .6rem; margin:.25rem 0 .75rem;
      color:var(--accent); background:var(--card);
    }
    .rule{ border-top:1px solid var(--rule); margin: 1.1rem 0; }

    .note{ background: var(--panel); border:1px solid var(--rule); padding:.8rem 1rem; color:var(--ink); opacity:.95; box-shadow:0 1px 0 rgba(0,0,0,.04); break-inside: avoid; }
    .pull{
      font-family:"Playfair Display",serif; font-size:22px; line-height:1.35; font-weight:600;
      padding:.8rem 1rem; background:var(--card); border-left:4px solid var(--accent); color:var(--ink);
      margin:1rem 0; break-inside: avoid;
    }

    aside{ position:sticky; top:16px; align-self:start; display:flex; flex-direction:column; gap:16px; }
    .panel{ border:1px solid var(--rule); background:var(--panel); padding:1rem; box-shadow: var(--shadow); border-radius:10px; }
    #map{
      height: 440px; border:1px solid var(--rule);
      background:var(--card); box-shadow: var(--shadow);
      border-radius:10px; overflow:hidden;
    }

    .filters{ display:flex; flex-wrap:wrap; gap:.5rem; }
    .chip{
      display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .6rem;
      border:1px solid var(--rule); background:var(--chip); border-radius:999px; font-size:.92rem;
      cursor:pointer; user-select:none;
    }
    .chip input{ accent-color:var(--accent); }

    .legend .key{ display:flex; align-items:center; gap:.5rem; margin:.1rem 0;}
    .dot{ width:12px; height:12px; border-radius:50%; display:inline-block; }
    .dot.danger{ background:var(--danger); } .dot.safe{ background:var(--safe); } .dot.event{ background:var(--event); }

    .gallery{ margin-top:18px; display:grid; grid-template-columns: repeat(2,1fr); gap:14px; }
    @media (max-width:680px){ .gallery{ grid-template-columns:1fr; } }
    figure{ margin:0; border:1px solid var(--rule); background:var(--card); break-inside: avoid; box-shadow:0 1px 0 rgba(0,0,0,.04); border-radius:8px; overflow:hidden; }
    figure img{ width:100%; height:auto; display:block; filter: grayscale(100%) contrast(1.05) saturate(.75); transition:filter .2s ease; }
    figure:hover img{ filter: grayscale(0%) contrast(1.05) saturate(1); }
    [data-theme="dark"] figure img{ filter: grayscale(100%) contrast(1.05) saturate(.7) brightness(.9); }

    .timeline{ list-style:none; margin:0; padding:0; display:grid; gap:.8rem; }
    .timeline li{ padding:.6rem .75rem; border:1px dashed var(--rule); background:var(--card); border-radius:8px; }

    footer{
      margin:28px auto 40px; max-width:1320px; padding:0 20px; color:var(--muted);
      border-top: 3px double var(--rule); padding-top:14px; font-size:.95rem;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <button id="themeToggle" class="theme-btn" aria-label="Promijeni temu">
        <svg id="iconSun" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="5"/><path d="M12 1v3M12 20v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M1 12h3M20 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12"/></svg>
        <svg id="iconMoon" style="display:none" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        <span id="themeLabel">Light</span>
      </button>
      <div class="masthead">GONZO NAPULJ ZA NJU</div>
      <div class="dek">Ironijski magazin-vodiƒç: vi≈°e teksta, vi≈°e mjesta, ‚Äúcase files‚Äù i interaktivna karta s filtrima. Humor crn, razum trezven.</div>
    </header>

    <!-- ====== Lijevi stupci: TEKST (skraƒáeno za primjer; ostaje kao u tvojoj verziji) ====== -->
    <main class="article">
      <p class="kicker">satira s ugraƒëenim airbagom</p>
      <p class="lead"><strong>Ovo je kompas kroz kaos.</strong> Ne nudi ‚Äúmafija turu‚Äù, nego realnost s ironijom. Procijeni, nasmij se i <em>vrati se ≈æiva, cijela i s mobitelom</em>.</p>

      <h2>Manifest pre≈æivljavanja</h2>
      <p><strong>Tvoje tijelo, tvoja granica.</strong> <em>Basta</em> je cijela reƒçenica. Minimalno nakita; <strong>crossbody</strong> sprijeda; telefon nikad uz rub kolnika. Bar je crkva: kad osjeti≈° previ≈°e ‚Äúljubavi‚Äù ‚Äî u bar/hotel. Skuter uvijek pobjeƒëuje.</p>
      <div class="note"><strong>Brzi set-up:</strong> powerbank; rezervna kartica + gotovina skriveno; adresa smje≈°taja na papiriƒáu; kopije dokumenata digitalno; la≈æni novƒçanik; kosa u rep.</div>

      <h2>Kartografski horoskop</h2>
      <p><strong>Quartieri Spagnoli</strong>, <strong>Forcella / Via Duomo</strong>, <strong>Rione Sanit√†</strong>, <strong>Garibaldi/Centrale</strong>, <strong>Spaccanapoli</strong> ‚Äî dr≈æi oƒçi otvorene. <strong>Lungomare</strong>, <strong>Castel dell‚ÄôOvo</strong>, <strong>Vomero</strong>, <strong>Pignasecca</strong>, <strong>Bellini</strong>, <strong>Chiaia</strong> ‚Äî ljepota bez drame.</p>

      <div class="pull">‚ÄúBar je crkva, telefon nije fenjer. Humor je ≈°tit, granice su zid.‚Äù</div>

      <h2>Case files</h2>
      <ul class="timeline">
        <li><strong>Faida di Scampia (2000-e)</strong> ‚Äî niz obraƒçuna u zoni ‚ÄúVele di Scampia‚Äù. <small>Sjever.</small></li>
        <li><strong>Forcella ‚Äî tragiƒçan sluƒçaj (2004)</strong> ‚Äî djevojka pogoƒëena tijekom mafija≈°kog obraƒçuna. <small>Oko Via Forcella/Via Duomo.</small></li>
        <li><strong>Secondigliano</strong> ‚Äî povijesno upori≈°te klanova; ƒçeste policijske akcije. <small>Sjever.</small></li>
      </ul>

      <h2>Galerija</h2>
      <div class="gallery">
        <figure><img src="https://commons.wikimedia.org/wiki/Special:FilePath/Quartieri%20Spagnoli,%20Naples%2020230622%2009.jpg" alt="Quartieri Spagnoli"><figcaption>Quartieri Spagnoli</figcaption></figure>
        <figure><img src="https://commons.wikimedia.org/wiki/Special:FilePath/Rione%20Sanit%C3%A0%201.jpg" alt="Rione Sanit√†"><figcaption>Rione Sanit√†</figcaption></figure>
        <figure><img src="https://commons.wikimedia.org/wiki/Special:FilePath/Napoli%20Centrale%20railway%20station%20in%202018.12.jpg" alt="Napoli Centrale"><figcaption>Napoli Centrale</figcaption></figure>
        <figure><img src="https://commons.wikimedia.org/wiki/Special:FilePath/Vele%20di%20Scampia%20Di%20Salvo2.jpg" alt="Vele di Scampia"><figcaption>Vele di Scampia</figcaption></figure>
      </div>
    </main>

    <!-- ====== Desni stupac: KARTA + PANELI ====== -->
    <aside>
      <div class="panel">
        <div class="filters" aria-label="Filtri slojeva">
          <label class="chip"><input type="checkbox" id="fDanger" checked> üî¥ Oprezne zone</label>
          <label class="chip"><input type="checkbox" id="fSafe" checked> üü¢ Opu≈°tenije</label>
          <label class="chip"><input type="checkbox" id="fEvent" checked> üü£ Dogaƒëaji/‚Äúcase files‚Äù</label>
        </div>
      </div>

      <div id="map" aria-label="Karta Napulja s oznaƒçenim zonama i dogaƒëajima">Uƒçitavam kartu‚Ä¶</div>

      <div class="panel legend">
        <div class="key"><span class="dot danger"></span> Zone poveƒáanog opreza</div>
        <div class="key"><span class="dot safe"></span> ‚ÄúSigurnije/opu≈°tenije‚Äù zone</div>
        <div class="key"><span class="dot event"></span> Povijesni dogaƒëaji / medijski sluƒçajevi</div>
        <p style="margin:.6rem 0 0;color:var(--muted);">Orijentacijska karta reputacija i javno poznatih sluƒçajeva. Ne zamjenjuje policijsku statistiku.</p>
      </div>
    </aside>
  </div>

  <footer>
    Fotografije: Wikimedia Commons. Karta: OpenStreetMap + Leaflet (&copy; CARTO za dark tiles). Tekst je satiriƒçan i pro-sigurnost.
  </footer>

  <script>
    (function(){
      // ---------- THEME ----------
      const root = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const label = document.getElementById('themeLabel');
      const iconSun = document.getElementById('iconSun');
      const iconMoon = document.getElementById('iconMoon');

      function setTheme(mode){
        root.setAttribute('data-theme', mode);
        localStorage.setItem('theme', mode);
        const isDark = mode === 'dark';
        iconSun.style.display = isDark ? 'none' : 'block';
        iconMoon.style.display = isDark ? 'block' : 'none';
        label.textContent = isDark ? 'Dark' : 'Light';
        // Switch map base if already created
        if (window._map && window._lightTiles && window._darkTiles){
          if (isDark){ window._map.removeLayer(window._lightTiles); window._darkTiles.addTo(window._map); }
          else       { window._map.removeLayer(window._darkTiles); window._lightTiles.addTo(window._map); }
        }
      }
      // Initial theme: saved -> system pref
      const saved = localStorage.getItem('theme');
      const initial = saved || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      setTheme(initial);

      btn.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        setTheme(next);
      });

      // ---------- MAP ----------
      function initMap(){
        if (typeof L === 'undefined'){
          const el = document.getElementById('map');
          if (el) el.textContent = 'Karta nije uƒçitana (CDN blokiran?). Otvori u drugom pregledniku ili spusti blokade.';
          return;
        }
        const isDark = root.getAttribute('data-theme') === 'dark';
        const map = L.map('map', {scrollWheelZoom:true}).setView([40.8518,14.2681], 12.4);

        // Base tiles (light/dark)
        const lightTiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19, attribution: '&copy; OpenStreetMap doprinositelji'
        });
        const darkTiles  = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
          maxZoom: 19, attribution: '&copy; OpenStreetMap doprinositelji &copy; CARTO'
        });
        (isDark ? darkTiles : lightTiles).addTo(map);

        // Expose globally for theme switch
        window._map = map; window._lightTiles = lightTiles; window._darkTiles = darkTiles;

        // Data
        const danger = [
          { name:'Quartieri Spagnoli', lat:40.8421, lng:14.2450, note:'≈†armantno i usko; noƒáu glavne crte.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Quartieri%20Spagnoli,%20Naples%2020230622%2009.jpg' },
          { name:'Forcella / Via Duomo', lat:40.8508, lng:14.26263, note:'Gusto i ≈æivo; kompaktna torba.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Napoli,%20Duomo%20di%20Napoli.jpg' },
          { name:'Rione Sanit√†', lat:40.8584, lng:14.2445, note:'Idi ranije naveƒçer, rezerviraj.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Rione%20Sanit%C3%A0%201.jpg' },
          { name:'Piazza Garibaldi / Napoli Centrale', lat:40.8515, lng:14.2698, note:'Pickpocket bingo; torba naprijed.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Napoli%20Centrale%20railway%20station%20in%202018.12.jpg' },
          { name:'Spaccanapoli', lat:40.84774, lng:14.25324, note:'≈†etnja da, ‚Äúfenjer od telefona‚Äù ne.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Spaccanapoli%20b%26l.jpg' }
        ];
        const safe = [
          { name:'Lungomare Caracciolo', lat:40.83102, lng:14.22645, note:'≈†etnica + zaljev.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Panoramica%20dal%20lungomare%20di%20Napoli%20sul%20golfo.jpg' },
          { name:"Castel dell'Ovo", lat:40.8279, lng:14.2480, note:'Simbol na moru.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Castel%20dell-Ovo.JPG' },
          { name:'Vomero (pogledi)', lat:40.8333, lng:14.2333, note:'Kava + panorame.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/View%20of%20the%20Gulf%20of%20Naples%20from%20the%20Hill%20of%20Vomero.jpg' },
          { name:'Mercato Pignasecca (danju)', lat:40.84639, lng:14.24781, note:'Street-food; torba naprijed.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Napoli%20mercato%20Pignasecca.jpg' },
          { name:'Piazza Bellini', lat:40.850486, lng:14.251614, note:'≈Ωivo, najljep≈°e ranije naveƒçer.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Piazza%20Bellini%20%28Napoli%29.jpg' },
          { name:'Chiaia', lat:40.83386, lng:14.22697, note:'Butici i barovi.',
            img:'https://upload.wikimedia.org/wikipedia/commons/6/6c/Napoli_-_Via_Chiaia.jpg' },
          { name:'Murales Maradona', lat:40.8434, lng:14.2484, note:'Ikona grada (danju).',
            img:'https://upload.wikimedia.org/wikipedia/commons/9/90/Napoli%2C_Murales_Maradona_in_quartiere_Spagnoli_02.jpg' },
          { name:'Galleria Umberto I', lat:40.8396, lng:14.2496, note:'Kupola i predah.',
            img:'https://upload.wikimedia.org/wikipedia/commons/4/4d/Napoli%2C_Galleria_Umberto_I.jpg' },
          { name:'Piazza del Plebiscito', lat:40.8358, lng:14.2488, note:'Monumentalno i prostrano.',
            img:'https://upload.wikimedia.org/wikipedia/commons/3/3f/Piazza_del_Plebiscito.jpg' }
        ];
        const events = [
          { name:'Faida di Scampia (2000-e)', lat:40.9013, lng:14.23498,
            note:'Serija obraƒçuna povezanih s Camorrom oko ‚ÄúVele di Scampia‚Äù. Danas u transformaciji; reputacija ostala.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Vele%20di%20Scampia%20Di%20Salvo2.jpg' },
          { name:'Forcella ‚Äî tragiƒçan sluƒçaj (2004)', lat:40.8512, lng:14.2620,
            note:'≈†iroko medijski popraƒáena smrt djevojke tijekom obraƒçuna. Orijentir: Via Forcella/Via Duomo.',
            img:'https://commons.wikimedia.org/wiki/Special:FilePath/Napoli,%20Duomo%20di%20Napoli.jpg' },
          { name:'Secondigliano ‚Äî policijske akcije', lat:40.9000, lng:14.2667,
            note:'Povijesno upori≈°te klanova; ƒçeste racije i uhiƒáenja.',
            img:'https://upload.wikimedia.org/wikipedia/commons/3/35/Napoli%2C_Secondigliano.jpg' }
        ];

        // Layers
        const redStyle   = {radius:8, color:'#9a1e1e', fillColor:'#9a1e1e', fillOpacity:.85};
        const greenStyle = {radius:8, color:'#0f6d3d', fillColor:'#0f6d3d', fillOpacity:.85};
        const eventStyle = {radius:8, color:'#5a48d6', fillColor:'#5a48d6', fillOpacity:.9};

        function popup(p){ return `<strong>${p.name}</strong><br/><em>${p.note}</em><br/>${p.img?`<a href="${p.img}" target="_blank" rel="noopener">Vidi fotografiju</a>`:''}`; }

        const Ldanger = L.layerGroup(danger.map(p=>L.circleMarker([p.lat,p.lng], redStyle).bindPopup(popup(p))));
        const Lsafe   = L.layerGroup(safe.map(p=>L.circleMarker([p.lat,p.lng], greenStyle).bindPopup(popup(p))));
        const Levent  = L.layerGroup(events.map(p=>L.circleMarker([p.lat,p.lng], eventStyle).bindPopup(popup(p))));

        Ldanger.addTo(map); Lsafe.addTo(map); Levent.addTo(map);

        // Filters
        document.getElementById('fDanger').addEventListener('change', e=> e.target.checked ? Ldanger.addTo(map) : map.removeLayer(Ldanger));
        document.getElementById('fSafe').addEventListener('change',   e=> e.target.checked ? Lsafe.addTo(map)   : map.removeLayer(Lsafe));
        document.getElementById('fEvent').addEventListener('change',  e=> e.target.checked ? Levent.addTo(map)  : map.removeLayer(Levent));
      }

      if (document.readyState !== 'loading') initMap();
      else document.addEventListener('DOMContentLoaded', initMap);
    })();
  </script>
</body>
</html>